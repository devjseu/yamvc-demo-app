/*! culturalMe v1.0.0 - 2013-12-16 
 *  License:  */
(function(){var e,t,n,i=[].slice;t=window.app||{},t.data=t.data||{},n=window.yamvc,e=n.Core.extend(function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],n.Core.apply(this,e),this}),e.prototype.init=function(){var e,t,a;if(e=arguments.length>=1?i.call(arguments,0):[],n.Core.prototype.init.apply(this,e),a=e[0]||{},t=a.config||{},this.set("initOpts",a),this.set("config",t),this.initConfig(),!this.getName)throw Error("Database name should be set")},e.prototype.connect=function(){return this.get("connect")||this.set("connect",new ydn.db.Storage(this.getName(),this.getSchema())),this},e.prototype.close=function(){return this.getConnection().close(),this.set("connect",null),this},e.prototype.getConnection=function(){return this.get("connect")||this.connect(),this.get("connect")},e.prototype.clear=function(){return this.getConnection().clear()},t.data.Db=e,window.app=t}).call(this),function(){var e,t,n,i=[].slice;t=window.app||{},t.data=t.data||{},t.data.proxy=t.data.proxy||{},n=window.yamvc,e=n.Core.extend(function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],n.Core.apply(this,e),this}),e.prototype.init=function(){var e,t,n;return e=arguments.length>=1?i.call(arguments,0):[],n=e[0]||{},t=n.config||{},t.idProperty="id",this.set("initOpts",n),this.set("config",t),this.initConfig(),this},e.prototype.getStatus=function(){return this.get("status")},e.prototype.getResponse=function(){return this.get("response")},e.prototype.read=function(e,t,n){var i,a,s;return a=this.getIdProperty(),"object"==typeof t[a]&&console.log(a),i=this.set.bind(this),s=this.getDb().getConnection().get(e,t[a]),s.done(function(e){return i("status","success"),t[a]=e,i("response",t),n()}),s.fail(function(e){return i("status","error"),i("response",e),n()}),this},e.prototype.create=function(e,t,n){var i,a,s;return i=this.set.bind(this),a=this.getIdProperty(),s=this.getDb().getConnection().put({name:e,keyPath:a},t),s.done(function(e){return i("status","success"),t[a]=e,i("response",t),n()}),s.fail(function(e){return i("status","error"),i("response",e),n()}),this},e.prototype.update=function(e,t,n){var i,a;return i=this.set.bind(this),a=this.getDb().getConnection().put(e,t),a.done(function(){return i("status","success"),i("response",t),n()}),a.fail(function(e){return i("status","error"),i("response",e),n()}),this},e.prototype.destroy=function(e,t,n){var i,a,s;return a=this.getIdProperty(),"object"==typeof t[a]&&console.log(a),i=this.set.bind(this),s=this.getDb().getConnection().remove(e,t[a]),s.done(function(){return i("status","success"),i("response",{}),n()}),s.fail(function(e){return i("status","error"),i("response",e),n()}),this},t.data.proxy.YdnDb=e,window.app=t}.call(this),function(){var e,t;e=window.app||{},t=window.yamvc,e.init=function(){return e.data.db=new e.data.Db({config:{name:"culturalMe",schema:{stores:[{name:"incomes",keyPath:"id",autoIncrement:!0,indexes:[{keyPath:"date"}]},{name:"expenses",keyPath:"id",autoIncrement:!0,indexes:[{keyPath:"date"}]}]}}}),e.layout=new e.views.Layout({config:{autoCreate:!0,tpl:"tpl-layout",renderTo:"#container"}}),e.income=new e.views.window.AddIncome({config:{autoCreate:!0,id:"add-income",tpl:"tpl-window",renderTo:"body"}}),e.income.render(),e.expense=new e.views.window.AddExpense({config:{autoCreate:!0,id:"add-expense",tpl:"tpl-window",renderTo:"body"}}),e.expense.render(),e.controlles={main:new t.Controller({config:{name:"Main",views:{layout:e.layout},events:{$layout:{render:function(){return e.models.balance.load(),setTimeout(function(){return e.mask.hide()},500)}},".add-expense a":{click:function(e,t){return t.preventDefault(),this.onExpenseBtnClick()}},".add-income a":{click:function(e,t){return t.preventDefault(),this.onIncomeBtnClick()}},'[yamvc-id="list-incomes"] a':{click:function(e,t){return t.preventDefault(),this.onListIncomesBtnClick()}},'[yamvc-id="list-expenses"] a':{click:function(e,t){return t.preventDefault(),this.onListExpensesBtnClick()}}}},onExpenseBtnClick:function(){return t.ViewManager.get("add-expense").show()},onIncomeBtnClick:function(){return t.ViewManager.get("add-income").show()},onListIncomesBtnClick:function(){return console.log("list incomes click")},onListExpensesBtnClick:function(){return console.log("list expenses click")}})},this},window.app=e,t.onReady(e.init)}.call(this),function(){var e,t,n,i=[].slice;t=window.app||{},t.models=t.models||{},n=window.yamvc,e=n.Model.extend(function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],n.Model.apply(this,e),this}),e.prototype.init=function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],n.Model.prototype.init.apply(this,e)},e.prototype.initConfig=function(){var e,t,a;return e=arguments.length>=1?i.call(arguments,0):[],t=this.get("config"),a=this.get("initOpts"),a.data={resources:0,expenses:0,available:0,month:1},t.namespace="balance",this.set("initOpts",a),n.Model.prototype.initConfig.apply(this,e)},e.prototype.setRange=function(e,t){return this.set("from",e),this.set("to",t)},e.prototype.load=function(){var e,n,a,s,o,r,l,c;return e=arguments.length>=1?i.call(arguments,0):[],l=this,n=0,a=new Date,s=new Date,a.setFullYear(2013,11,1),s.setFullYear(2014,1,1),o=t.data.db.getConnection(),c=o.from("incomes"),c.where("date",">=",a.getTime(),"<",s.getTime()).list().done(function(e){var t,i;for(t=0,i=e.length;i>t;)n+=parseFloat(e[t].value),t++;return r()}),r=function(){var e;return e=o.from("expenses"),e.where("date",">=",a.getTime(),"<",s.getTime()).list().done(function(e){var t,i;for(t=0,i=e.length;i>t;)n-=parseFloat(e[t].value),t++;return l.$set("resources",n)})},this},e.prototype.recaulculate=function(){var e;e=arguments.length>=1?i.call(arguments,0):[]},e.prototype.all=function(){var e;e=arguments.length>=1?i.call(arguments,0):[]},e.prototype.getBalance=function(){var e;e=arguments.length>=1?i.call(arguments,0):[]},t.models.balance=new e,window.app=t}.call(this),function(){var e,t,n,i=[].slice;t=window.app||{},t.models=t.models||{},n=window.yamvc,e=n.Model.extend(function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],n.Model.apply(this,e),this}),e.prototype.init=function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],n.Model.prototype.init.apply(this,e)},e.prototype.initConfig=function(){var e,t,a;return e=arguments.length>=1?i.call(arguments,0):[],t=this.get("config"),a=this.get("initOpts"),a.data={type:"AreaChart",title:"Day by day",isStacked:!0,data:[["Day","Balance"],["1",165],["2",135],["3",157],["4",139],["5",136],["7",136],["8",136],["9",136],["10",136],["11",136],["12",136],["13",136],["14",136],["15",136],["16",165],["17",135],["18",457],["19",139],["20",336],["21",136],["22",136],["23",136],["24",136],["25",136],["26",136],["27",136],["28",1936],["29",2136],["30",2136]]},t.namespace="balance",this.set("initOpts",a),n.Model.prototype.initConfig.apply(this,e)},e.prototype.setRange=function(){},e.prototype.load=function(){var e;e=arguments.length>=1?i.call(arguments,0):[]},e.prototype.recaulculate=function(){var e;e=arguments.length>=1?i.call(arguments,0):[]},e.prototype.all=function(){var e;e=arguments.length>=1?i.call(arguments,0):[]},e.prototype.getChart=function(){var e;e=arguments.length>=1?i.call(arguments,0):[]},t.models.Chart=e,window.app=t}.call(this),function(){var e,t,n,i=[].slice;t=window.app||{},t.models=t.models||{},n=window.yamvc,e=n.Model.extend(function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],n.Model.apply(this,e),this}),e.prototype.init=function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],n.Model.prototype.init.apply(this,e)},e.prototype.initConfig=function(){var e,t,a;return e=arguments.length>=1?i.call(arguments,0):[],t=this.get("config"),a=this.get("initOpts"),t.namespace="expenses",a.data=a.data||{},a.data.date=a.data.date||+new Date,n.Model.prototype.initConfig.apply(this,e)},t.models.Expense=e,window.app=t}.call(this),function(){var e,t,n,i=[].slice;t=window.app||{},t.models=t.models||{},n=window.yamvc,e=n.Model.extend(function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],n.Model.apply(this,e),this}),e.prototype.init=function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],n.Model.prototype.init.apply(this,e)},e.prototype.initConfig=function(){var e,t,a;return e=arguments.length>=1?i.call(arguments,0):[],t=this.get("config"),a=this.get("initOpts"),t.namespace="incomes",a.data=a.data||{},a.data.date=a.data.date||+new Date,n.Model.prototype.initConfig.apply(this,e)},t.models.Income=e,window.app=t}.call(this),function(){var e,t,n,i=[].slice;t=window.app||{},t.views=t.views||{},n=window.yamvc,e=n.View.extend(function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],n.View.apply(this,e),this}),e.prototype.init=function(){var e,a;return e=arguments.length>=1?i.call(arguments,0):[],n.View.prototype.init.apply(this,e),a=this.get("config"),a.views={buttonExpense:new t.views.Button({config:{tpl:"tpl-button",renderTo:".add-expense",models:{locale:new n.Model({config:{namespace:"locale"},data:{text:"Add Expense"}})}}}),buttonIncome:new t.views.Button({config:{tpl:"tpl-button",renderTo:".add-income",models:{locale:new n.Model({config:{namespace:"locale"},data:{text:"Add Income"}})}}})}},t.views.Bar=e,window.app=t}.call(this),function(){var e,t,n,i=[].slice;t=window.app||{},t.views=t.views||{},n=window.yamvc,e=n.View.extend(function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],n.View.apply(this,e),this}),e.prototype.init=function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],n.View.prototype.init.apply(this,e),this.bindEvents(),this},e.prototype.bindEvents=function(){return this.addListener("render",this.bindElements.bind(this)),this.addListener("render",this.ajustBarsWidth.bind(this)),this.getModel("balance").addListener("dataExpensesChange",this.updateBalance.bind(this)),this.getModel("balance").addListener("dataResourcesChange",this.updateBalance.bind(this)),this.getModel("balance").addListener("dataChange",this.updateBalance.bind(this)),this},e.prototype.bindElements=function(){return this.set("$resources",this.queryEl(".bar-balance-resources")),this.set("$expenses",this.queryEl(".bar-balance-expenses")),this},e.prototype.updateBalance=function(){return this.recalculateModel(),this.partialRender(".bar-balance-resources"),this.partialRender(".bar-balance-expenses"),this.partialRender(".bar-balance-current"),this.ajustBarsWidth(),this},e.prototype.ajustBarsWidth=function(){var e,t,n,i,a,s;return e=this.getModel("balance").$get("expenses"),i=this.getModel("balance").$get("resources"),0===e&&0===i?(n=0,s=100,t=0,a=0):e>=i?(n=100,s=0,t=0,a=0):(n=0===e?0:parseInt(e/(i/100)),s=100-n,t=0,a=n),this.get("$resources").style.width=s+"%",this.get("$resources").style.left=a+"%",this.get("$expenses").style.width=n+"%",this.get("$expenses").style.left=t+"%",this},e.prototype.recalculateModel=function(){},t.views.BarBalance=e,window.app=t}.call(this),function(){var e,t,n,i=[].slice;t=window.app||{},t.views=t.views||{},n=window.yamvc,e=n.View.extend(function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],n.View.apply(this,e),this}),t.views.Button=e,window.app=t}.call(this),function(){var e,t,n,i=[].slice;t=window.app||{},t.views=t.views||{},n=window.yamvc,e=n.View.extend(function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],n.View.apply(this,e),this}),e.prototype.init=function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],n.View.prototype.init.apply(this,e),this.bindEvents()},e.prototype.initConfig=function(){var e,a;return e=arguments.length>=1?i.call(arguments,0):[],a=this.get("config"),a.models={chart:new t.models.Chart},n.View.prototype.initConfig.apply(this,e)},e.prototype.bindEvents=function(){return this.addListener("render",this.initChart.bind(this))},e.prototype.initChart=function(){var e;return e=new(google.visualization[this.getModel("chart").$get("type")])(this.queryEl(".chart-container")),e.draw(google.visualization.arrayToDataTable(this.getModel("chart").$get("data")),{title:this.getModel("chart").$get("title"),width:this.queryEl(".chart-container").offsetWidth,height:this.queryEl(".chart-container").offsetHeight,vAxis:{title:this.getModel("chart").$get("titlevAxis")},hAxis:{title:this.getModel("chart").$get("titlehAxis")}}),this.set("chart",e)},t.views.Chart=e,window.app=t}.call(this),function(){var e,t,n,i=[].slice;t=window.app||{},t.views=t.views||{},n=window.yamvc,e=n.View.extend(function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],n.View.apply(this,e),this}),e.prototype.init=function(){var e,a;return e=arguments.length>=1?i.call(arguments,0):[],n.View.prototype.init.apply(this,e),a=this.get("config"),a.views={barBalance:new t.views.BarBalance({config:{id:"current-balance",tpl:"tpl-bar-balance",renderTo:".balance-container",models:{locale:new n.Model({config:{namespace:"locale"},data:{legend:"Legend",expenses:"expenses",resources:"resources",currentBalance:"Current balance"}}),balance:t.models.balance}}}),barActions:new t.views.Bar({config:{id:"action-bar",tpl:"tpl-bar-action",renderTo:".layout-action-bar"}}),menu:new t.views.Menu({config:{id:"menu",tpl:"tpl-menu",renderTo:".menu"}}),chart:new t.views.Chart({config:{id:"dailyChart",tpl:"tpl-chart",renderTo:".container"}})}},t.views.Layout=e,window.app=t}.call(this),function(){var e,t,n,i=[].slice;t=window.app||{},t.views=t.views||{},n=window.yamvc,e=n.View.extend(function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],n.View.apply(this,e),this}),e.prototype.show=function(){var e;return e=this.get("el").style,e.display="table"},e.prototype.hide=function(){var e;return e=this.get("el").style,e.display="none"},t.views.Mask=e,window.app=t}.call(this),function(){var e,t,n,i=[].slice;t=window.app||{},t.views=t.views||{},n=window.yamvc,e=n.View.extend(function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],n.View.apply(this,e),this}),e.prototype.init=function(){var e,a;return e=arguments.length>=1?i.call(arguments,0):[],n.View.prototype.init.apply(this,e),a=this.get("config"),a.views={buttonIncomes:new t.views.Button({config:{id:"list-incomes",tpl:"tpl-button",renderTo:".menu-action",models:{locale:new n.Model({config:{namespace:"locale"},data:{text:"List all incomes"}})}}}),buttonExpenses:new t.views.Button({config:{id:"list-expenses",tpl:"tpl-button",renderTo:".menu-action",models:{locale:new n.Model({config:{namespace:"locale"},data:{text:"List all expenses"}})}}})}},t.views.Menu=e,window.app=t}.call(this),function(){var e,t,n,i=[].slice;t=window.app||{},t.views=t.views||{},n=window.yamvc,e=n.View.extend(function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],n.View.apply(this,e),this.bindEvents(),this}),e.prototype.bindEvents=function(){return this.addListener("render",this.resize.bind(this)),this.addListener("render",this.bindClose.bind(this)),this.addListener("render",this.bindDOMEvents.bind(this))},e.prototype.initConfig=function(){var e,a;return e=arguments.length>=1?i.call(arguments,0):[],a=this.get("config"),a.width=a.width||400,a.height=a.height||300,a.views=a.views||{},a.views.close=new t.views.Button({config:{tpl:"tpl-button",renderTo:".top-bar",models:{locale:new n.Model({config:{namespace:"locale"},data:{text:"X"}})}}}),a=this.get("config"),a.height=200,a.views=a.views||{},a.views.add=new t.views.Button({config:{tpl:"tpl-button",renderTo:".bottom-bar",models:{locale:new n.Model({config:{namespace:"locale"},data:{text:"Add"}})}}}),n.View.prototype.initConfig.apply(this,e)},e.prototype.bindClose=function(){var e;return e=this,this.queryEl("a").addEventListener("click",function(t){return t.preventDefault(),e.hide(),this},!0)},e.prototype.bindDOMEvents=function(){return this.queryEl("#form-name").addEventListener("keyup",this.validateName.bind(this)),this.queryEl("#form-date").addEventListener("keyup",this.validateDate.bind(this)),this.queryEl("#form-value").addEventListener("keyup",this.validateValue.bind(this)),this.queryEl(".bottom-bar a").addEventListener("click",this.processForm.bind(this),!1)},e.prototype.processForm=function(){},e.prototype.validateName=function(){var e;return e=this.queryEl("#form-name").value,e&&e.length>3?this.queryEl("#form-name").setAttribute("class",""):this.queryEl("#form-name").setAttribute("class","invalid")},e.prototype.validateDate=function(){var e;return e=this.queryEl("#form-date").value,this.parseDate(e)?this.queryEl("#form-date").setAttribute("class",""):this.queryEl("#form-date").setAttribute("class","invalid")},e.prototype.validateValue=function(){var e,t;return t=this.queryEl("#form-value").value,e=/^\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*$/,e.test(t)?this.queryEl("#form-value").setAttribute("class",""):this.queryEl("#form-value").setAttribute("class","invalid")},e.prototype.resize=function(){var e;return e=this.queryEl(".window-vertical-center").style,e.width=this.getWidth()+"px",e.height=this.getHeight()+"px"},e.prototype.parseDate=function(e){var t,n,i,a,s;return s=function(e){var t;return(null!=(t=2===(""+e).length)?t:{"":"0"})+e},n=e.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/),t=n?new Date(n[3],n[2]-1,n[1]):null,a=t&&e===[s(t.getDate()),s(t.getMonth()+1),t.getFullYear()].join("/"),i=t&&e===[t.getDate(),t.getMonth()+1,t.getFullYear()].join("/"),a||i?t:null},e.prototype.show=function(){var e;return e=this.get("el").style,e.display="table"},e.prototype.hide=function(){var e;return e=this.get("el").style,e.display="none"},t.views.Window=e,window.app=t}.call(this),function(){var e,t,n,i=[].slice;t=window.app||{},t.views=t.views||{},t.views.window=t.views.window||{},n=window.yamvc,e=t.views.Window.extend(function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],t.views.Window.apply(this,e),this}),e.prototype.initConfig=function(){var e,a;return e=arguments.length>=1?i.call(arguments,0):[],a=this.get("config"),a.models={locale:new n.Model({config:{namespace:"locale"},data:{name:"Name",date:"Date",value:"Value",exName:"e.g Book",exDate:"e.g 23/9/2013",exValue:"e.g 25.50"}}),expense:new t.models.Expense({config:{namespace:"expenses",proxy:new t.data.proxy.YdnDb({config:{db:t.data.db}})}})},t.views.Window.prototype.initConfig.apply(this,e),this.bindModelEvents()},e.prototype.bindEvents=function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],t.views.Window.prototype.bindEvents.apply(this,e),this.addListener("render",this.addClass.bind(this))},e.prototype.bindModelEvents=function(){return this.getModel("expense").addListener("saved",this.afterModelSave.bind(this))},e.prototype.processForm=function(){var e,n,i,a,s;for(s=[],n=this.queryEls("form input"),this.validateName(),this.validateDate(),this.validateValue(),a={},e=0,i=n.length;i>e;)n[e].getAttribute("class").search(/invalid/)>-1&&s.push(1),a[n[e].name]=n[e].value,e++;return 0===s.length&&(a.date=+new Date(this.parseDate(a.date)),this.getModel("expense").setData(a),t.mask.show(),this.getModel("expense").save()),this},e.prototype.afterModelSave=function(){return this.queryEl("form").reset(),t.mask.hide(),t.models.balance.load(),this.hide()},e.prototype.addClass=function(){var e;return e=this.queryEl("form"),e.setAttribute("class","add-expenses"),e.setAttribute("data-type","add-expenses")},t.views.window.AddExpense=e,window.app=t}.call(this),function(){var e,t,n,i=[].slice;t=window.app||{},t.views=t.views||{},t.views.window=t.views.window||{},n=window.yamvc,e=t.views.Window.extend(function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],t.views.Window.apply(this,e),this}),e.prototype.initConfig=function(){var e,a;return e=arguments.length>=1?i.call(arguments,0):[],a=this.get("config"),a.models={locale:new n.Model({config:{namespace:"locale"},data:{name:"Name",date:"Date",value:"Value",exName:"e.g Salary",exDate:"e.g 23/3/2013",exValue:"e.g 2005.55"}}),income:new t.models.Income({config:{namespace:"incomes",proxy:new t.data.proxy.YdnDb({config:{db:t.data.db}})}})},t.views.Window.prototype.initConfig.apply(this,e),this.bindModelEvents()},e.prototype.bindEvents=function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],t.views.Window.prototype.bindEvents.apply(this,e),this.addListener("render",this.addClass.bind(this))},e.prototype.bindModelEvents=function(){return this.getModel("income").addListener("saved",this.afterModelSave.bind(this))},e.prototype.processForm=function(){var e,n,i,a,s;for(s=[],n=this.queryEls("form input"),this.validateName(),this.validateDate(),this.validateValue(),a={},e=0,i=n.length;i>e;)n[e].getAttribute("class").search(/invalid/)>-1&&s.push(1),a[n[e].name]=n[e].value,e++;return 0===s.length&&(a.date=+new Date(this.parseDate(a.date)),this.getModel("income").setData(a),t.mask.show(),this.getModel("income").save()),this},e.prototype.afterModelSave=function(){return this.queryEl("form").reset(),t.mask.hide(),t.models.balance.load(),this.hide()},e.prototype.addClass=function(){var e;return e=this.queryEl("form"),e.setAttribute("class","add-income"),e.setAttribute("data-type","add-income")},t.views.window.AddIncome=e,window.app=t}.call(this);
//@ sourceMappingURL=culturalMe-v1.0.0.min.js.map